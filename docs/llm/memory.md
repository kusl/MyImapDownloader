Purpose & context
Kushal is developing a comprehensive email archiving and search system consisting of two main .NET 10 applications: MyImapDownloader for downloading and archiving emails from IMAP servers, and MyEmailSearch for indexing and searching the archived emails. The system is designed to handle large-scale email archives (currently managing 35GB+ across multiple accounts from providers like mailo.com, disroot.org, and gmx.com) with potential to scale to hundreds of gigabytes. The project emphasizes safety-first design with read-only IMAP operations, data integrity through atomic writes, and comprehensive observability via OpenTelemetry instrumentation.
Key constraints include strict adherence to free and open source software dependencies, cross-platform compatibility (particularly Linux/Fedora), and avoiding external database dependencies in favor of SQLite. The system operates on Kushal's Acer Swift Go Fedora computer with deployment via install.sh scripts that create self-contained binaries in /opt with system-wide access.
Current state
The MyImapDownloader component is fully functional and actively used for regular email backups across multiple accounts. It features delta synchronization with UIDVALIDITY handling, SQLite-backed deduplication via Message-ID indexing, and maintains extremely lightweight database overhead (190KB for 35GB archives). The system successfully prevents re-downloading existing emails and operates with read-only IMAP access for safety.
MyEmailSearch has been developed with SQLite FTS5 full-text search capabilities, structured field searches (to:, from:, subject:), and a System.CommandLine-based CLI interface. Recent work focused on resolving compilation issues related to System.CommandLine API migrations and implementing proper query escaping for FTS5 injection prevention. The search system supports incremental indexing based on file modification timestamps and includes comprehensive test coverage using TUnit framework.
A shared MyImapDownloader.Core library has been extracted to eliminate code duplication between the two applications, consolidating telemetry infrastructure, path resolution utilities, email metadata models, and SQLite helper components.
Key learnings & principles
The project follows several established principles: dump.txt serves as the authoritative source of truth for all code changes, requiring developers to check this file before modifications. Complete, single-file shell scripts are preferred over fragmented instructions across multiple files. The system maintains strict read-only guarantees for IMAP operations, ensuring emails are never deleted from servers or local storage.
Technical patterns that have proven effective include XDG-compliant directory specifications for cross-platform compatibility, atomic write patterns using temporary directories for crash safety, and comprehensive error handling with Polly retry logic and circuit breakers. The delta synchronization approach using UIDVALIDITY indexing provides efficient deduplication without re-processing existing emails.
Approach & patterns
Development follows a safety-first methodology with extensive testing using TUnit, NSubstitute for mocking, and AwesomeAssertions. The codebase emphasizes proper async/await patterns with ConfigureAwait(false), comprehensive telemetry instrumentation, and robust error handling throughout all operations.
The email processing workflow uses a six-step delta sync algorithm that handles UIDVALIDITY changes gracefully and maintains data integrity through atomic operations. Search functionality implements incremental indexing with timestamp-based filtering and supports complex query syntax combining structured fields with full-text search capabilities.
Code organization maintains backward compatibility while enabling shared infrastructure through the Core library. All changes are validated through comprehensive build verification and test execution before deployment.
Tools & resources
The system uses SQLite with FTS5 virtual tables for full-text search, WAL mode for performance optimization, and B-tree indexes for structured queries. Email parsing relies on MimeKit for robust .eml file processing, while the CLI interface uses System.CommandLine 2.0+ for modern command-line interactions.
Development tooling includes .NET 10 with central package management via Directory.Packages.props, TUnit testing framework, and OpenTelemetry for observability with JSONL file exporters. The deployment process uses self-contained .NET binaries eliminating runtime dependencies, with install.sh scripts managing system-wide installation to /opt directories.
